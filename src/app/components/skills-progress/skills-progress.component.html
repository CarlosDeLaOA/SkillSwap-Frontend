<div class="skills-progress">
  <div class="content" *ngIf="!isLoading && hasData()">
    <div class="dropdown-container">
      <select class="skill-dropdown" [(ngModel)]="selectedSkill" (change)="onSkillChange()">
        <option *ngFor="let skill of skillsData; let i = index" [value]="i">
          {{ skill.skillName }}
        </option>
      </select>
    </div>

    <div class="chart-container" *ngIf="selectedSkill !== null">
      <!-- Área expandida que incluye gráfico + tooltip -->
      <div class="hover-area" 
           (mouseenter)="showTooltipInfo()" 
           (mouseleave)="hideTooltipInfo()">
        
        <div class="pie-chart-wrapper">
          <svg class="pie-chart" viewBox="0 0 200 200">
            <circle
              class="pie-segment completed"
              cx="100"
              cy="100"
              r="80"
              [attr.stroke-dasharray]="getStrokeDasharray()"
              [attr.stroke-dashoffset]="0"
            ></circle>
            <circle
              class="pie-segment pending"
              cx="100"
              cy="100"
              r="80"
              [attr.stroke-dasharray]="getStrokeDasharray()"
              [attr.stroke-dashoffset]="getCompletedCircumference()"
            ></circle>
          </svg>
          
          <div class="percentage-label">
            {{ getCompletedPercentage() }}%
          </div>
        </div>

        <!-- Tooltip dentro del área de hover -->
        <div class="tooltip" *ngIf="showTooltip">
          <div class="tooltip-content">
            <div class="tooltip-row completed-row">
              <span class="tooltip-label">
                <span class="tooltip-dot completed-dot"></span>
                Completado:
              </span>
              <span class="tooltip-value">
                {{ tooltipData.completed }} sesiones ({{ tooltipData.completedPercentage }}%)
              </span>
            </div>
            <div class="tooltip-row pending-row">
              <span class="tooltip-label">
                <span class="tooltip-dot pending-dot"></span>
                Pendiente:
              </span>
              <span class="tooltip-value">
                {{ tooltipData.pending }} sesiones ({{ tooltipData.pendingPercentage }}%)
              </span>
            </div>
            <div class="tooltip-total">
              <strong>Total: {{ tooltipData.completed + tooltipData.pending }} sesiones</strong>
            </div>
          </div>
        </div>
      </div>

      <div class="legend">
        <div class="legend-item">
          <span class="legend-color completed"></span>
          <span class="legend-label">Completado</span>
        </div>
        <div class="legend-item">
          <span class="legend-color pending"></span>
          <span class="legend-label">Pendiente</span>
        </div>
      </div>
    </div>
  </div>

  <div class="no-data" *ngIf="!isLoading && !hasData()">
    <p>No hay datos de sesiones disponibles</p>
  </div>
  
  <div class="loading" *ngIf="isLoading">
    <div class="spinner"></div>
  </div>
</div>
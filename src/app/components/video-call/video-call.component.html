<div class="video-call-container">
  <!-- Loading State -->
  <div *ngIf="isLoading" class="loading-overlay">
    <div class="loading-content">
      <div class="spinner"></div>
      <p>Conectando a la videollamada...</p>
      <p *ngIf="retryCount > 0" class="retry-message">
        Reintento {{ retryCount }}/{{ maxRetries }}
      </p>
    </div>
  </div>

  <!-- Error State -->
  <div *ngIf="!isLoading && errorMessage" class="error-container">
    <div class="error-content">
      <i class='bx bx-error-circle'></i>
      <h2>Error de Conexión</h2>
      <p>{{ errorMessage }}</p>
      <button class="btn-primary" (click)="initializeVideoCall()">
        Reintentar
      </button>
      <button class="btn-secondary" (click)="leaveCall()">
        Volver al Dashboard
      </button>
    </div>
  </div>

  <!-- Video Call Active -->
  <div *ngIf="isConnected && !errorMessage" class="video-call-active">
    
    <!-- Session Info Badge -->
    <div class="session-info-badge">
      <i class='bx bx-time'></i>
      <span class="timer">00:00</span>
      <span class="divider">|</span>
      <span class="session-title">Sesión #{{ sessionId }}</span>
      <span *ngIf="videoCallData?.isModerator" class="moderator-badge">
        <i class='bx bx-star'></i> Instructor
      </span>
    </div>

    <!-- Main Content Area -->
    <div class="content-wrapper">
      
      <!-- Left: Main Video + Controls -->
      <div class="left-section">
        
        <!-- Main Video -->
        <div class="main-video-container">
          <div id="jitsi-container" class="jitsi-container"></div>
        </div>

        <!-- Jitsi Controls (will appear here automatically) -->
        
      </div>

      <!-- Right: Participants Sidebar -->
      <div class="right-sidebar">
        <div class="participant-tile participant-1">
          <div class="participant-content">
            <span class="participant-initials">JM</span>
            <span class="participant-label">Jose Mario Ar...</span>
          </div>
        </div>
        <div class="participant-tile participant-2">
          <div class="participant-content">
            <i class='bx bx-user'></i>
          </div>
        </div>
        <div class="participant-tile participant-3">
          <div class="participant-content">
            <i class='bx bx-user'></i>
          </div>
        </div>
        <div class="participant-tile participant-4">
          <div class="participant-content">
            <i class='bx bx-user'></i>
          </div>
        </div>
      </div>

    </div>

    <!-- Custom Right Buttons (Bottom Right) -->
    <div class="custom-action-buttons">
      <button class="action-btn" title="Participantes" (click)="toggleParticipants()">
        <i class='bx bx-group'></i>
      </button>
      <button class="action-btn" title="Chat" (click)="toggleChat()">
        <i class='bx bx-message-rounded'></i>
      </button>
      <button class="action-btn" title="Documentos" (click)="toggleDocuments()">
        <i class='bx bx-file'></i>
      </button>
    </div>

  </div>
</div>

<!-- Permission Dialog -->
<div *ngIf="showPermissionDialog" class="permission-dialog-overlay">
  <div class="permission-dialog">
    <i class='bx bx-video-recording'></i>
    <h2>Permisos Necesarios</h2>
    <p>Para unirte a la videollamada, necesitamos acceso a:</p>
    <ul>
      <li><i class='bx bx-camera'></i> Cámara</li>
      <li><i class='bx bx-microphone'></i> Micrófono</li>
    </ul>
    <p class="note">El navegador te pedirá permiso en breve.</p>
  </div>
</div>

<!-- Modal: End Session Confirmation (Only for Instructor) -->
<div *ngIf="showEndSessionModal" class="modal-overlay" (click)="closeEndSessionModal()">
  <div class="modal-content" (click)="$event.stopPropagation()">
    <div class="modal-header">
      <h2>Finalizar Sesión</h2>
      <button class="modal-close" (click)="closeEndSessionModal()">
        <i class='bx bx-x'></i>
      </button>
    </div>
    <div class="modal-body">
      <p>¿Qué deseas hacer?</p>
    </div>
    <div class="modal-actions">
      <button class="modal-btn btn-danger" (click)="endSessionForEveryone()">
        <i class='bx bx-stop-circle'></i>
        Finalizar para todos
      </button>
      <button class="modal-btn btn-secondary" (click)="leaveSessionOnly()">
        <i class='bx bx-exit'></i>
        Solo abandonar
      </button>
      <button class="modal-btn btn-cancel" (click)="closeEndSessionModal()">
        Cancelar
      </button>
    </div>
  </div>
</div>
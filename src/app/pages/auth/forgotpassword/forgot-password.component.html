<!-- forgot-password.component.html -->
<!-- #region container -->
<div class="fp-container">
  <!-- #region brand -->
  <section class="brand-side">
    <img src="assets/brand/skillswap-logo.svg" alt="SkillSwap" class="brand-logo" />
    <h1 class="brand-title"><span>Skill</span><span class="accent">Swap</span></h1>
  </section>
  <!-- #endregion brand -->

  <!-- #region form -->
  <section class="form-side">
    <div *ngIf="message()" class="alert ok">{{ message() }}</div>
    <div *ngIf="error()" class="alert error">{{ error() }}</div>

    <!-- #region panel-email -->
    <div class="panel" [class.open]="openPanel()==='email'" #emailPanel>
      <button class="panel-header" type="button" (click)="toggle('email')">
        <span class="chev" aria-hidden="true">▾</span>
        <span class="title accent-green">Cambio de contraseña</span>
      </button>
      <div class="panel-body">
        <p class="helper">Ingresa tu correo electrónico para confirmar tu identidad.</p>
        <form [formGroup]="emailForm" (ngSubmit)="sendEmail()" class="stack">
          <input formControlName="email" type="email" placeholder="Correo" />
          <div class="hint" *ngIf="emailForm.controls.email.touched && emailForm.controls.email.invalid">Correo inválido.</div>
          <button class="btn primary" type="submit" [disabled]="loading()">{{ loading() ? 'Enviando…' : 'Enviar' }}</button>
        </form>
      </div>
    </div>
    <!-- #endregion panel-email -->

    <!-- #region panel-code -->
    <div class="panel" [class.open]="openPanel()==='code'" #codePanel>
      <button class="panel-header" type="button" (click)="toggle('code')" [class.disabled]="!canOpenCode()" [attr.aria-disabled]="!canOpenCode()">
        <span class="chev" aria-hidden="true">▾</span>
        <span class="title">Comprobar código</span>
      </button>
      <div class="panel-body">
        <form [formGroup]="codeForm" (ngSubmit)="verifyCode()" class="stack">
          <input #codeInput formControlName="code" type="text" inputmode="numeric" placeholder="Código" [disabled]="!canOpenCode()" />
          <div class="hint" *ngIf="codeForm.controls.code.touched && codeForm.controls.code.invalid">Ingresa el código recibido (4–8 dígitos).</div>
          <button class="btn primary" type="submit" [disabled]="loading() || !canOpenCode()">{{ loading() ? 'Verificando…' : 'Verificar' }}</button>
        </form>
      </div>
    </div>
    <!-- #endregion panel-code -->

    <!-- #region panel-new -->
    <div class="panel" [class.open]="openPanel()==='new'" #newPanel>
      <button class="panel-header" type="button" (click)="toggle('new')" [class.disabled]="!canOpenNew()" [attr.aria-disabled]="!canOpenNew()">
        <span class="chev" aria-hidden="true">▾</span>
        <span class="title">Nueva contraseña</span>
      </button>
      <div class="panel-body">
        <form [formGroup]="newPwdForm" (ngSubmit)="setNewPassword()" class="stack">
          <input #pwdInput type="password" placeholder="Nueva contraseña" formControlName="password" [disabled]="!canOpenNew()" />
          <input type="password" placeholder="Confirmar contraseña" formControlName="confirm" [disabled]="!canOpenNew()" />
          <div class="hint" *ngIf="newPwdForm.touched && !passwordsMatch() && canOpenNew()">Las contraseñas no coinciden.</div>
          <button class="btn primary" type="submit" [disabled]="loading() || !canOpenNew() || !passwordsMatch()">{{ loading() ? 'Guardando…' : 'Guardar' }}</button>
        </form>
      </div>
    </div>
    <!-- #endregion panel-new -->

    <a routerLink="/login" class="back-link">Volver a iniciar sesión</a>
  </section>
  <!-- #endregion form -->
</div>
<!-- #endregion container -->

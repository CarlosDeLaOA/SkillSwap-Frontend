<!-- ========================================
     forgot-password.component.html
     ======================================== -->
<div class="fp-container">
  <!-- Lado izquierdo - Hero Section con semicírculo -->
  <div class="fp-hero">
    <div class="hero-content">
      <h1 class="hero-title">
        Recupera tu<br />
        <span class="highlight">acceso</span>
      </h1>
    </div>
  </div>

  <!-- Lado derecho - Formulario -->
  <section class="fp-form-section">
    <div class="form-wrapper">
      <!-- Logo -->
      <div class="logo-container">
        <h1 class="logo">
          <span class="logo-skill">Skill</span><span class="logo-swap">Swap</span>
        </h1>
      </div>

      <!-- Alertas -->
      <div *ngIf="message()" class="alert alert-success">
        <box-icon name='check-circle' size="20px" color="#aae16b"></box-icon>
        <span>{{ message() }}</span>
      </div>
      <div *ngIf="error()" class="alert alert-error">
        <box-icon name='error-circle' size="20px" color="#ff4444"></box-icon>
        <span>{{ error() }}</span>
      </div>

      <!-- Panel Email -->
      <div class="panel" [class.open]="openPanel()==='email'" #emailPanel>
        <button class="panel-header" type="button" (click)="toggle('email')">
          <span class="chev" aria-hidden="true">▾</span>
          <span class="panel-title">Cambio de contraseña</span>
        </button>
        <div class="panel-body">
          <p class="helper-text">Ingresa tu correo electrónico para confirmar tu identidad.</p>
          <form [formGroup]="emailForm" (ngSubmit)="sendEmail()" class="form-stack">
            <div class="form-group">
              <input formControlName="email" type="email" placeholder="Correo electrónico" class="form-input" />
              <div class="error-message" *ngIf="emailForm.controls.email.touched && emailForm.controls.email.invalid">
                <box-icon name='error-circle' size="16px" color="#ff4444"></box-icon>
                <span>Correo inválido</span>
              </div>
            </div>
            <button class="btn-primary" type="submit" [disabled]="loading()">
              {{ loading() ? 'Enviando…' : 'Enviar código' }}
            </button>
          </form>
        </div>
      </div>

      <!-- Panel Code -->
      <div class="panel" [class.open]="openPanel()==='code'" #codePanel>
        <button class="panel-header" type="button" (click)="toggle('code')" [class.disabled]="!canOpenCode()"
          [attr.aria-disabled]="!canOpenCode()">
          <span class="chev" aria-hidden="true">▾</span>
          <span class="panel-title">Verificar código</span>
        </button>

        <div class="panel-body">
          <form [formGroup]="codeForm" (ngSubmit)="verifyCode()" class="form-stack">
            <div class="form-group">
              <input #codeInput formControlName="code" type="text" inputmode="numeric" 
                     placeholder="Código de 6 dígitos" class="form-input"
                     [disabled]="!canOpenCode()" />
              <div class="error-message" *ngIf="codeForm.controls.code.touched && codeForm.controls.code.invalid">
                <box-icon name='error-circle' size="16px" color="#ff4444"></box-icon>
                <span>Ingresa el código recibido (6 dígitos)</span>
              </div>
            </div>
            <button class="btn-primary" type="submit" [disabled]="loading() || !canOpenCode()">
              {{ loading() ? 'Verificando…' : 'Verificar código' }}
            </button>
          </form>

          <div class="resend-section">
            <button class="btn-secondary" type="button" (click)="resendCode()" [disabled]="!canResend()">
              Reenviar código
            </button>
            <span class="cooldown-text" *ngIf="cooldown() > 0">
              Disponible en {{ cooldown() }}s
            </span>
          </div>
        </div>
      </div>

      <!-- Panel Nueva Contraseña -->
      <div class="panel" [class.open]="openPanel()==='new'" #newPanel>
        <button class="panel-header" type="button" (click)="toggle('new')" [class.disabled]="!canOpenNew()"
          [attr.aria-disabled]="!canOpenNew()">
          <span class="chev" aria-hidden="true">▾</span>
          <span class="panel-title">Nueva contraseña</span>
        </button>
        
        <div class="panel-body">
          <form [formGroup]="newPwdForm" (ngSubmit)="setNewPassword()" class="form-stack">
            <div class="form-group">
              <input #pwdInput 
                     type="password" 
                     placeholder="Nueva contraseña" 
                     class="form-input"
                     formControlName="password"
                     (input)="onPasswordChange()"
                     [disabled]="!canOpenNew()" />
              <div class="error-message" *ngIf="passwordValidationError() && newPwdForm.controls.password.touched">
                <box-icon name='error-circle' size="16px" color="#ff4444"></box-icon>
                <span>{{ passwordValidationError() }}</span>
              </div>
            </div>

            <div class="form-group">
              <input type="password" 
                     placeholder="Confirmar contraseña" 
                     class="form-input"
                     formControlName="confirm"
                     [disabled]="!canOpenNew()" />
              <div class="error-message" *ngIf="newPwdForm.controls.confirm.touched && !passwordsMatch() && canOpenNew()">
                <box-icon name='error-circle' size="16px" color="#ff4444"></box-icon>
                <span>Las contraseñas no coinciden</span>
              </div>
            </div>
            
            <button class="btn-primary" type="submit" [disabled]="loading() || !canOpenNew()">
              {{ loading() ? 'Guardando…' : 'Cambiar contraseña' }}
            </button>
          </form>
        </div>
      </div>

      <div class="form-links">
        <a routerLink="/login" class="link-back">Volver a iniciar sesión</a>
      </div>
    </div>
  </section>
</div>
<div class="reviews-page">
  <!-- Header -->
  <header class="page-header">
    <div class="header-content">
      <h1 class="page-title">
        <i class='bx bx-message-square'></i>
        Todas mis reseñas
      </h1>
      <p class="page-subtitle">
        Aquí puedes ver todas las reseñas que han dejado tus estudiantes
      </p>
    </div>

    <!-- Controles de ordenamiento -->
    <div class="sort-controls">
      <label for="sort-select" class="sort-label">
        <i class='bx bx-sort'></i>
        Ordenar por:
      </label>
      <select
        id="sort-select"
        class="sort-select"
        [(ngModel)]="sortOrder"
        (change)="changeSortOrder(sortOrder)"
        [disabled]="isLoading">
        <option value="newest"> Más recientes primero</option>
        <option value="oldest"> Más antiguas primero</option>
      </select>
    </div>
  </header>

  <!-- Estado de carga -->
  <div *ngIf="isLoading" class="loading-container">
    <div class="spinner"></div>
    <p>Cargando reseñas...</p>
  </div>

  <!-- Estado de error -->
  <div *ngIf="! isLoading && errorMessage" class="error-container">
    <div class="error-content">
      <i class='bx bx-error-circle'></i>
      <h3>Error al cargar reseñas</h3>
      <p>{{ errorMessage }}</p>
      <button class="retry-button" (click)="loadReviews()">
        <i class='bx bx-refresh'></i>
        Reintentar
      </button>
    </div>
  </div>

  <!-- Estado vacío -->
  <div *ngIf="!isLoading && totalElements === 0 && ! errorMessage" class="empty-container">
    <div class="empty-content">
      <i class='bx bx-message-square'></i>
      <h3>Aún no tienes reseñas</h3>
      <p>Cuando tus estudiantes dejen reseñas, aparecerán aquí</p>
    </div>
  </div>

  <!-- Lista de reseñas -->
  <main *ngIf="! isLoading && reviews.length > 0" class="reviews-container">
    <!-- Información de paginación -->
    <div class="pagination-info">
      <span class="info-text">
        Mostrando
        <strong>{{ itemsRangeStart }}</strong>
        a
        <strong>{{ itemsRangeEnd }}</strong>
        de
        <strong>{{ totalElements }}</strong>
        reseñas
      </span>
    </div>

    <!-- Tarjetas de reseñas en lista vertical -->
    <div class="reviews-list">
      <div *ngFor="let review of reviews; let i = index" class="review-item" [attr.data-index]="i">
        <!-- Sección de información del estudiante - ANÓNIMA -->
        <div class="review-learner">
          <div class="learner-avatar anonymous">
            <i class='bx bx-user-voice'></i>
          </div>
          <div class="learner-details">
            <h4 class="learner-name">Estudiante Anónimo</h4>
            <p class="review-date">{{ review.formattedDate }}</p>
          </div>
          <div class="rating-badge" [title]="review.rating + ' de 5 estrellas'">
            {{ review.ratingStars }}
          </div>
        </div>

        <!-- Sección de contenido de la reseña -->
        <div class="review-content">
          <p class="review-comment">{{ review.comment || 'Sin comentario adicional' }}</p>
        </div>

        <!-- Sección de metadatos -->
        <div class="review-metadata">
          <div class="metadata-item session-info">
            <i class='bx bx-book'></i>
            <span class="label">Sesión:</span>
            <span class="value">
              {{ review.learningSession?.title || review.sessionTitle || 'Sesión desconocida' }}
            </span>
          </div>

          <div class="metadata-item duration-info">
            <i class='bx bx-time'></i>
            <span class="label">Duración:</span>
            <span class="value">
              {{ review.learningSession?.durationMinutes || 0 }} minutos
            </span>
          </div>

          <div class="metadata-item skill-info">
            <i class='bx bx-bulb'></i>
            <span class="label">Habilidad:</span>
            <span class="value">
              {{ review.skill?.name || review.learningSession?.title || 'N/A' }}
            </span>
          </div>
        </div>

        <!-- Indicadores adicionales -->
        <div class="review-indicators">
          <div *ngIf="review.hasAudio" class="indicator audio-indicator" title="Incluye grabación de audio">
            <i class='bx bx-microphone'></i>
            <span>Audio</span>
          </div>
          <div *ngIf="review.hasTranscription && ! review.hasAudio" class="indicator transcription-indicator" title="Incluye transcripción">
            <i class='bx bx-file-blank'></i>
            <span>Transcripción</span>
          </div>
          <div *ngIf="review.storedAsComment" class="indicator comment-indicator" title="Guardado como comentario">
            <i class='bx bx-check-circle'></i>
            <span>Comentario guardado</span>
          </div>
        </div>

        <!-- Divisor -->
        <div class="review-divider"></div>
      </div>
    </div>

    <!-- Controles de paginación -->
    <footer class="pagination-footer">
      <button
        class="pagination-button"
        (click)="previousPage()"
        [disabled]="isFirstPage"
        title="Página anterior">
        <i class='bx bx-chevron-left'></i>
        Anterior
      </button>

      <div class="page-indicators">
        <span class="current-page-info">
          Página <strong>{{ currentPage + 1 }}</strong> de <strong>{{ totalPages }}</strong>
        </span>
      </div>

      <button
        class="pagination-button"
        (click)="nextPage()"
        [disabled]="isLastPage"
        title="Siguiente página">
        Siguiente
        <i class='bx bx-chevron-right'></i>
      </button>
    </footer>
  </main>
</div>